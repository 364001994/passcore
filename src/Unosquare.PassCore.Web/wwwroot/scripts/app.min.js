(function () {
    'use strict';

    var app = angular.module('app', ['ngRoute', 'ui.bootstrap']);

})();
(function () {
    'use strict';

    angular.module('app').constant("ViewOptions", {
        ApplicationTitle: "Self-Service Account Management Tools",
        ChangePasswordTitle: "Change Account Password",
        ChangePasswordForm: {
            UsernameLabel: "Username",
            UsernamePlaceholder: "username@domain.com",
            UsernameHelpblock: "Your organization's username",
            CurrentPasswordLabel: "Current Password",
            CurrentPasswordPlaceholder: "",
            CurrentPasswordHelpblock: "Enter your current password",
            NewPasswordLabel: "New Password",
            NewPasswordPlaceholder: "",
            NewPasswordHelpblock: 'Enter a strong password. You can use <a href="http://passwordsgenerator.net/" target="_blank">this tool</a> to help you create one.',
            NewPasswordAgainLabel: "Re-enter New Password",
            NewPasswordAgainPlaceholder: "",
            NewPasswordAgainHelpblock: "Enter your new password again"
        }
    });
})();
(function() {
    'use strict';

    angular.module('app').config([
        '$routeProvider', '$locationProvider', 'ViewOptions', function ($routeProvider, $locationProvider, ViewOptions) {
            $routeProvider.
                when('/', {
                    templateUrl: 'views/change-password.html',
                    title: ViewOptions.ChangePasswordTitle
                }).otherwise({
                    redirectTo: '/'
                });

            $locationProvider.html5Mode(true);
        }
    ]);
})();
(function () {
    'use strict';

    angular.module('app')
        .controller('TitleCtrl', [
            '$scope', '$route', '$location', '$routeParams', 'ViewOptions',
            function ($scope, $route, $location, $routeParams, ViewOptions) {
                var me = this;
                me.content = ViewOptions.ApplicationTitle;

                $scope.$on('$routeChangeSuccess', function () {
                    me.content = $route.current.title + " - " + ViewOptions.ApplicationTitle;
                });
            }
        ]).controller('ChangePasswordCtrl', [
            '$scope', '$http', 'ViewOptions',
            function ($scope, $http, ViewOptions) {
                var me = this;

                $scope.ViewOptions = ViewOptions;

                $scope.Form = {
                    Username: '',
                    CurrentPassword: '',
                    NewPassword: '',
                    NewPasswordVerify: '',
                };

                $scope.Submit = function () {
                    $('div.form-overlay').show();
                    $http({
                        method: 'POST',
                        url: 'api/password',
                        data: $scope.Form,
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    }).then(function successCallback(response) {
                        $('div.form-overlay').hide();
                        // this callback will be called asynchronously
                        // when the response is available
                    }, function errorCallback(response) {
                        $('div.form-overlay').hide();
                        // called asynchronously if an error occurs
                        // or server returns response with an error status.
                    });
                }
            }
        ]);
})();